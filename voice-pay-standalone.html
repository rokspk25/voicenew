<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>VoicePay - Voice Payment App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mobile-container { 
            width: 360px;
            height: 800px;
            margin: 0 auto; 
            background: white; 
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            overflow: visible;
        }
        
        @media (max-width: 428px) {
            .mobile-container {
                width: 100%;
                height: 100vh;
                max-width: 100%;
                box-shadow: none;
            }
            
            body {
                padding: 0;
            }
        }
        
        /* Mobile touch optimizations */
        @media (max-width: 768px) {
            button, a {
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        .waveform-bar { animation: wave 1.5s ease-in-out infinite; }
        @keyframes wave { 0%, 100% { transform: scaleY(0.4); } 50% { transform: scaleY(1); } }
        .waveform-bar:nth-child(1) { animation-delay: 0s; }
        .waveform-bar:nth-child(2) { animation-delay: 0.1s; }
        .waveform-bar:nth-child(3) { animation-delay: 0.2s; }
        .waveform-bar:nth-child(4) { animation-delay: 0.3s; }
        .waveform-bar:nth-child(5) { animation-delay: 0.4s; }
        .waveform-bar:nth-child(6) { animation-delay: 0.5s; }
        .waveform-bar:nth-child(7) { animation-delay: 0.6s; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .pulse-animate { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .spin { animation: spin 1s linear infinite; }
        
        /* Safe area for notched devices */
        @supports (padding: max(0px)) {
            .mobile-container {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Voice Recognition Utility
        const parseVoiceCommand = (transcript) => {
            const originalText = transcript.trim();
            const text = originalText.toLowerCase().trim();
            
            // Common words to exclude from name extraction (English + Hinglish + Tamil + Kannada)
            const commonWords = new Set([
                'pay', 'send', 'transfer', 'to', 'rupees', 'rs', 'rupee', 'rupees',
                'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'for', 'of',
                'with', 'by', 'from', 'as', 'is', 'was', 'are', 'were', 'been', 'be',
                'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could',
                'should', 'may', 'might', 'must', 'can', 'this', 'that', 'these', 'those',
                // Hinglish words
                'ko', 'bejo', 'bhejo', 'de', 'do', 'kar', 'karo', 'bhej', 'bhejna', 'dena',
                'karna', 'mein', 'se', 'par', 'ki', 'ka', 'ke', 'ne', 'bhej', 'bhejdo',
                // Tamil words
                'ku', 'kku', 'kodungo', 'kudungo', 'kodu', 'kodunga', 'kudunga', 'koduthu',
                'kuduthu', 'kodukka', 'kudukka', 'anuppu', 'anuppungo', 'anuppunga',
                'anuppuva', 'anuppuvom', 'koduthu', 'kuduthu', 'kodukka', 'kudukka',
                'kodukiren', 'kodutharen', 'anuppu', 'anuppuvom',
                // Kannada words
                'ge', 'kke', 'kodu', 'kalisu', 'koduva', 'koduvudu', 'kalisuva', 'kalisuvudu',
                'koduve', 'kalisuve', 'kodu', 'kalisu', 'koduva', 'kalisuva', 'koduve',
                'kalisuve', 'kodu', 'kalisu'
            ]);
            
            // Action verbs to remove (all languages)
            const actionVerbs = new Set([
                'pay', 'send', 'transfer', 'bejo', 'bhejo', 'de', 'do', 'kar', 'karo',
                'kodungo', 'kudungo', 'kodu', 'kodunga', 'kudunga', 'anuppu', 'anuppungo',
                'kodu', 'kalisu', 'koduva', 'kalisuva'
            ]);
            
            // Extract amount - comprehensive patterns for all languages
            const amountPatterns = [
                // Pattern 1: "₹100" or "100 rupees" at start
                /^(?:₹|rupees?|rs\.?)?\s*(\d+(?:[.,]\d+)?)/i,
                // Pattern 2: "pay/send ₹100" or "₹100 pay/send"
                /(?:pay|send|transfer|bejo|bhejo|kodu|kalisu|kodungo|anuppu)\s*(?:₹|rupees?|rs\.?)?\s*(\d+(?:[.,]\d+)?)/i,
                /(\d+(?:[.,]\d+)?)\s*(?:rupees?|rs\.?|₹)\s*(?:pay|send|transfer|bejo|bhejo|kodu|kalisu|kodungo|anuppu)/i,
                // Pattern 3: After prepositions "to/ko/ku/ge ₹100"
                /(?:to|ko|ku|kku|ge|kke|mein|se|par)\s*(?:₹|rupees?|rs\.?)?\s*(\d+(?:[.,]\d+)?)/i,
                // Pattern 4: Before prepositions "₹100 to/ko/ku/ge"
                /(\d+(?:[.,]\d+)?)\s*(?:rupees?|rs\.?|₹)?\s*(?:to|ko|ku|kku|ge|kke)/i,
                // Pattern 5: Standalone number (fallback)
                /(\d+(?:[.,]\d+)?)/i
            ];
            
            let amount = null;
            let amountIndex = -1;
            let amountMatch = null;
            
            for (const pattern of amountPatterns) {
                const match = text.match(pattern);
                if (match) {
                    amount = match[1].replace(/[.,]/g, ''); // Remove commas/decimals for now
                    amountIndex = match.index;
                    amountMatch = match;
                    break;
                }
            }
            
            // Helper function to capitalize name properly
            const capitalizeName = (name) => {
                return name.split(/\s+/).map(word => {
                    if (word.length === 0) return word;
                    // Preserve original capitalization if it looks like a proper name
                    if (word[0] === word[0].toUpperCase() && word.length > 2) {
                        return word;
                    }
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                }).join(' ');
            };
            
            // Remove amount, currency, and action verbs from text for name extraction
            let textForName = text
                .replace(/\d+(?:[.,]\d+)?/g, '') // Remove all numbers (including decimals)
                .replace(/₹|rupees?|rs\.?/gi, '') // Remove currency words
                .replace(/\s+/g, ' ') // Normalize spaces
                .trim();
            
            // Remove action verbs
            actionVerbs.forEach(verb => {
                const verbRegex = new RegExp(`\\b${verb}\\b`, 'gi');
                textForName = textForName.replace(verbRegex, '');
            });
            textForName = textForName.replace(/\s+/g, ' ').trim();
            
            let payee = null;
            
            // Strategy 1: Look for "[name] ko/ku/ge/to" pattern (most common across languages)
            const prepositionPatterns = [
                { pattern: /([a-z]+(?:\s+[a-z]+)*?)\s+ko\s+/i, lang: 'Hinglish' },
                { pattern: /([a-z]+(?:\s+[a-z]+)*?)\s+(?:ku|kku)\s+/i, lang: 'Tamil' },
                { pattern: /([a-z]+(?:\s+[a-z]+)*?)\s+(?:ge|kke)\s+/i, lang: 'Kannada' },
                { pattern: /(?:^|\s)to\s+([a-z]+(?:\s+[a-z]+)*?)(?:\s|$)/i, lang: 'English' }
            ];
            
            for (const { pattern } of prepositionPatterns) {
                const match = textForName.match(pattern);
                if (match) {
                    const potentialName = match[1] ? match[1].trim() : match[0].replace(/^(?:to|ko|ku|kku|ge|kke)\s+/i, '').trim();
                    if (potentialName) {
                        const nameWords = potentialName.split(/\s+/).filter(word => 
                            word.length > 1 && 
                            !commonWords.has(word.toLowerCase()) && 
                            !actionVerbs.has(word.toLowerCase()) &&
                            !word.match(/^\d+$/) &&
                            word.length > 2 // Names are usually longer than 2 chars
                        );
                        if (nameWords.length > 0) {
                            payee = capitalizeName(nameWords.join(' '));
                            break;
                        }
                    }
                }
            }
            
            // Strategy 2: If amount found, look for name around the amount
            if (!payee && amountIndex >= 0 && amountMatch) {
                const beforeAmount = text.substring(0, amountIndex).trim();
                const afterAmount = text.substring(amountIndex + amountMatch[0].length).trim();
                
                // Check before amount for "[name] ko/ku/ge [amount]" pattern
                const beforePatterns = [
                    /([a-z]+(?:\s+[a-z]+)*?)\s+ko\s*$/i,
                    /([a-z]+(?:\s+[a-z]+)*?)\s+(?:ku|kku)\s*$/i,
                    /([a-z]+(?:\s+[a-z]+)*?)\s+(?:ge|kke)\s*$/i,
                    /([a-z]+(?:\s+[a-z]+)*?)\s+to\s*$/i
                ];
                
                for (const pattern of beforePatterns) {
                    const match = beforeAmount.match(pattern);
                    if (match) {
                        const potentialName = match[1].trim();
                        const nameWords = potentialName.split(/\s+/).filter(word => 
                            word.length > 2 && 
                            !commonWords.has(word.toLowerCase()) && 
                            !actionVerbs.has(word.toLowerCase()) &&
                            !word.match(/^\d+$/)
                        );
                        if (nameWords.length > 0) {
                            payee = capitalizeName(nameWords.join(' '));
                            break;
                        }
                    }
                }
                
                // If still no payee, check after amount (but before verbs)
                if (!payee) {
                    // Remove all action verbs and prepositions from after amount
                    let afterAmountClean = afterAmount;
                    const allVerbsAndPreps = [...actionVerbs, 'to', 'ko', 'ku', 'kku', 'ge', 'kke', 'mein', 'se', 'par'];
                    allVerbsAndPreps.forEach(word => {
                        const regex = new RegExp(`\\b${word}\\b`, 'gi');
                        afterAmountClean = afterAmountClean.replace(regex, '');
                    });
                    afterAmountClean = afterAmountClean.replace(/\s+/g, ' ').trim();
                    
                    const afterAmountWords = afterAmountClean.split(/\s+/)
                        .filter(word => 
                            word.length > 2 && 
                            !commonWords.has(word.toLowerCase()) && 
                            !actionVerbs.has(word.toLowerCase()) &&
                            !word.match(/^\d+$/) &&
                            !word.match(/^(rupees?|rs|rupee)$/i)
                        )
                        .slice(0, 3); // Take up to 3 words
                    
                    if (afterAmountWords.length > 0) {
                        payee = capitalizeName(afterAmountWords.join(' '));
                    }
                }
            }
            
            // Strategy 3: Extract from end of sentence (last meaningful words)
            if (!payee) {
                const words = textForName.split(/\s+/).filter(word => 
                    word.length > 2 && 
                    !commonWords.has(word.toLowerCase()) &&
                    !actionVerbs.has(word.toLowerCase()) &&
                    !word.match(/^\d+$/)
                );
                
                if (words.length > 0) {
                    // Take last 1-2 words as potential name
                    const potentialNameWords = words.slice(-2);
                    if (potentialNameWords.length > 0) {
                        payee = capitalizeName(potentialNameWords.join(' '));
                    }
                }
            }
            
            // Strategy 4: Look for capitalized words in original transcript (names are often capitalized)
            if (!payee) {
                const words = originalText.split(/\s+/);
                const capitalizedWords = words.filter(word => 
                    word.length > 2 &&
                    word[0] === word[0].toUpperCase() &&
                    word[0] !== word[0].toLowerCase() && // Ensure it's actually capitalized
                    !word.match(/^\d+$/) &&
                    !commonWords.has(word.toLowerCase()) &&
                    !actionVerbs.has(word.toLowerCase())
                );
                
                if (capitalizedWords.length > 0) {
                    // Take the last capitalized word(s) as name
                    const nameWords = capitalizedWords.slice(-2);
                    payee = capitalizeName(nameWords.join(' '));
                }
            }
            
            // Strategy 5: Extract first meaningful word(s) that aren't verbs/prepositions
            if (!payee) {
                const words = textForName.split(/\s+/).filter(word => 
                    word.length > 2 && 
                    !commonWords.has(word.toLowerCase()) &&
                    !actionVerbs.has(word.toLowerCase()) &&
                    !word.match(/^\d+$/)
                );
                
                if (words.length > 0) {
                    // Take first 1-2 words as potential name
                    const potentialNameWords = words.slice(0, 2);
                    if (potentialNameWords.length > 0) {
                        payee = capitalizeName(potentialNameWords.join(' '));
                    }
                }
            }
            
            // Final cleanup: remove any remaining common words from payee
            if (payee) {
                const payeeWords = payee.split(/\s+/).filter(word => 
                    word.length > 0 &&
                    !commonWords.has(word.toLowerCase()) &&
                    !actionVerbs.has(word.toLowerCase())
                );
                if (payeeWords.length > 0) {
                    payee = capitalizeName(payeeWords.join(' '));
                } else {
                    payee = null;
                }
            }
            
            return { amount, payee, rawText: transcript };
        };

        // Global recognition instance to reuse and avoid permission prompts
        let globalRecognitionInstance = null;
        let globalRecognitionState = {
            finalTranscript: '',
            silenceTimeout: null,
            isProcessing: false,
            onResult: null,
            onError: null,
            isRunning: false,
            isStarting: false
        };


        const createVoiceRecognition = (onResult, onError) => {
            const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
            
            if (!SpeechRecognition) {
                return { start: () => {}, stop: () => {}, isSupported: false };
            }

            // Reuse existing recognition instance if available
            let recognition = globalRecognitionInstance;
            
            if (!recognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-IN';
                globalRecognitionInstance = recognition;
                
                // Set up event handlers only once
                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            globalRecognitionState.finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    if (globalRecognitionState.onResult && !globalRecognitionState.isProcessing) {
                        globalRecognitionState.onResult({
                            transcript: globalRecognitionState.finalTranscript + interimTranscript,
                            isFinal: false
                        });
                    }

                    if (globalRecognitionState.silenceTimeout) {
                        clearTimeout(globalRecognitionState.silenceTimeout);
                    }

                    if (interimTranscript === '' && globalRecognitionState.finalTranscript.trim() !== '' && !globalRecognitionState.isProcessing) {
                        globalRecognitionState.silenceTimeout = setTimeout(() => {
                            if (!globalRecognitionState.isProcessing && globalRecognitionState.finalTranscript.trim() !== '') {
                                globalRecognitionState.isProcessing = true;
                                const parsed = parseVoiceCommand(globalRecognitionState.finalTranscript.trim());
                                try {
                                    if (globalRecognitionState.isRunning) {
                                        recognition.stop();
                                        globalRecognitionState.isRunning = false;
                                    }
                                } catch (e) {
                                    // Already stopped, ignore
                                    globalRecognitionState.isRunning = false;
                                }
                                if (parsed.amount || parsed.payee) {
                                    if (globalRecognitionState.onResult) {
                                        globalRecognitionState.onResult(parsed);
                                    }
                                } else {
                                    if (globalRecognitionState.onError) {
                                        globalRecognitionState.onError('Could not understand the command. Please try again.');
                                    }
                                }
                                // Reset for next use
                                globalRecognitionState.finalTranscript = '';
                                globalRecognitionState.isProcessing = false;
                            }
                        }, 3500);
                    }
                };

                recognition.onerror = (event) => {
                    if (globalRecognitionState.onError && event.error !== 'no-speech') {
                        globalRecognitionState.onError(event.error);
                    }
                };

                recognition.onend = () => {
                    globalRecognitionState.isRunning = false;
                    globalRecognitionState.isStarting = false;
                    
                    // Only process if we have transcript and haven't processed yet
                    if (globalRecognitionState.finalTranscript.trim() !== '' && !globalRecognitionState.isProcessing) {
                        globalRecognitionState.isProcessing = true;
                        const parsed = parseVoiceCommand(globalRecognitionState.finalTranscript.trim());
                        if (parsed.amount || parsed.payee) {
                            if (globalRecognitionState.onResult) {
                                globalRecognitionState.onResult(parsed);
                            }
                        } else if (globalRecognitionState.onError) {
                            globalRecognitionState.onError('Could not understand the command. Please try again.');
                        }
                    }
                    // Reset state for next use
                    globalRecognitionState.finalTranscript = '';
                    globalRecognitionState.isProcessing = false;
                };
            }

            // Update callbacks
            globalRecognitionState.onResult = onResult;
            globalRecognitionState.onError = onError;

            const start = () => {
                // Prevent multiple simultaneous starts - this causes permission prompts
                if (globalRecognitionState.isStarting || globalRecognitionState.isRunning) {
                    return; // Already starting or running, don't start again
                }

                // Reset state
                globalRecognitionState.finalTranscript = '';
                globalRecognitionState.isProcessing = false;
                if (globalRecognitionState.silenceTimeout) {
                    clearTimeout(globalRecognitionState.silenceTimeout);
                    globalRecognitionState.silenceTimeout = null;
                }

                // Mark as starting to prevent duplicate calls
                globalRecognitionState.isStarting = true;

                // Only start if not already running
                try {
                    recognition.start();
                    globalRecognitionState.isRunning = true;
                    globalRecognitionState.isStarting = false;
                } catch (e) {
                    globalRecognitionState.isStarting = false;
                    // If already started, that's fine - mark as running
                    if (e.name === 'InvalidStateError' || e.message?.includes('already started')) {
                        globalRecognitionState.isRunning = true;
                        return;
                    }
                    // If permission denied
                    if (e.name === 'NotAllowedError' || e.message?.includes('not allowed')) {
                        if (globalRecognitionState.onError) {
                            globalRecognitionState.onError('not-allowed');
                        }
                    }
                }
            };

            const stop = () => {
                // Clear timeout
                if (globalRecognitionState.silenceTimeout) {
                    clearTimeout(globalRecognitionState.silenceTimeout);
                    globalRecognitionState.silenceTimeout = null;
                }
                // Reset state
                globalRecognitionState.finalTranscript = '';
                globalRecognitionState.isProcessing = false;
                globalRecognitionState.isStarting = false;
                // Stop recognition
                try {
                    if (globalRecognitionState.isRunning) {
                        recognition.stop();
                    }
                    globalRecognitionState.isRunning = false;
                } catch (e) {
                    // Ignore errors when stopping
                    globalRecognitionState.isRunning = false;
                }
            };

            return { start, stop, isSupported: true };
        };

        // Helper function to get avatar color and initials
        const getAvatarStyle = (name) => {
            const colors = [
                'bg-orange-500', 'bg-green-500', 'bg-blue-500', 'bg-red-500', 
                'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500'
            ];
            const initials = name
                .split(' ')
                .map(n => n[0])
                .join('')
                .toUpperCase()
                .slice(0, 2);
            const colorIndex = name.length % colors.length;
            return { color: colors[colorIndex], initials };
        };

        const suggestions = [
            { name: 'Prashant Upadhyay', amount: '20,000', status: 'Paid today', type: 'paid' },
            { name: 'Abhilasha Khare', amount: '100', status: 'Paid yesterday', type: 'paid' },
            { name: 'Kartik Khadelwal', amount: '108', status: 'Received on 26 Sep 2024', type: 'received' },
            { name: 'Abheek', amount: '80', status: 'Paid on 2 Nov 2024', type: 'paid' },
            { name: 'Nitin Kumar Bramhankar Sharma', amount: '108', status: 'Paid on 12 Aug 2024', type: 'paid' }
        ];

        const contacts = [
            { name: 'Abheek', phone: '9564758565' },
            { name: 'Anchal', phone: '9364750666' },
            { name: 'Akanksha', phone: '9978606789' },
            { name: 'Abhilasha Khare', phone: '9876543210' },
            { name: 'Rahul', phone: '9123456789' },
            { name: 'Priya', phone: '9234567890' }
        ];

        // Voice Bottom Sheet Component
        const VoiceBottomSheet = ({ isOpen, onClose, onPaymentData }) => {
            const [transcription, setTranscription] = useState('');
            const [state, setState] = useState('listening');
            const [errorMessage, setErrorMessage] = useState('');
            const voiceRecognitionRef = useRef(null);
            const transcriptionRef = useRef('');

            const handleVoiceResult = useCallback((result) => {
                if (result.transcript !== undefined) {
                    transcriptionRef.current = result.transcript;
                    setTranscription(result.transcript);
                    return;
                }

                if (result.amount || result.payee) {
                    setState('processing');
                    setTranscription(result.rawText || transcriptionRef.current);
                    
                    setTimeout(() => {
                        onPaymentData({
                            payee: result.payee || 'Unknown',
                            amount: result.amount || '0',
                            method: 'UPI'
                        });
                        onClose();
                    }, 1500);
                } else {
                    setState('error');
                    setErrorMessage('Could not understand the command. Please try again.');
                }
            }, [onPaymentData, onClose]);

            const handleVoiceError = useCallback((error) => {
                setState('error');
                if (error === 'no-speech') {
                    setErrorMessage('No speech detected. Please try again.');
                } else if (error === 'not-allowed') {
                    setErrorMessage('Microphone permission denied. Please enable microphone access.');
                } else {
                    setErrorMessage('Voice recognition error. Please try again.');
                }
            }, []);

            useEffect(() => {
                if (isOpen && state === 'listening') {
                    const voiceRecognition = createVoiceRecognition(handleVoiceResult, handleVoiceError);
                    voiceRecognitionRef.current = voiceRecognition;

                    if (voiceRecognition.isSupported) {
                        voiceRecognition.start();
                    } else {
                        setState('error');
                        setErrorMessage('Voice recognition is not supported in your browser.');
                    }

                    return () => {
                        if (voiceRecognitionRef.current) {
                            voiceRecognitionRef.current.stop();
                        }
                    };
                }
            }, [isOpen, state, handleVoiceResult, handleVoiceError]);

            const handleClose = () => {
                if (voiceRecognitionRef.current) {
                    voiceRecognitionRef.current.stop();
                }
                setState('listening');
                setTranscription('');
                setErrorMessage('');
                onClose();
            };

            const handleRetry = () => {
                setState('listening');
                setTranscription('');
                setErrorMessage('');
            };

            if (!isOpen) return null;

            return React.createElement(React.Fragment, null,
                React.createElement('div', {
                    className: 'absolute inset-0 bg-black/50 z-40',
                    onClick: handleClose,
                    style: { position: 'absolute', top: 0, left: 0, right: 0, bottom: 0, backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 40 }
                }),
                React.createElement('div', {
                    className: 'absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl shadow-2xl z-50',
                    style: {
                        position: 'absolute',
                        bottom: 0,
                        left: 0,
                        right: 0,
                        width: '100%',
                        backgroundColor: 'white',
                        borderTopLeftRadius: '24px',
                        borderTopRightRadius: '24px',
                        boxShadow: '0 -4px 20px rgba(0,0,0,0.15)',
                        zIndex: 50,
                        maxHeight: '640px',
                        overflow: 'hidden'
                    }
                },
                    React.createElement('div', { className: 'flex justify-center pt-3 pb-2' },
                        React.createElement('div', { className: 'w-12 h-1.5 bg-gray-300 rounded-full' })
                    ),
                    React.createElement('div', { className: 'px-6 pb-8 pt-4' },
                        React.createElement('h2', { className: 'text-3xl font-bold text-black text-center mb-2' }, 'Listening...'),
                        React.createElement('p', { className: 'text-base text-gray-500 text-center mb-1' }, 'Try saying'),
                        React.createElement('p', { className: 'text-lg font-semibold text-green-600 text-center mb-6' }, '"Pay ₹400 to Prashant"'),
                        // Waveform Animation - Show when listening
                        state === 'listening' && React.createElement('div', {
                            className: 'flex items-end justify-center gap-1 mb-6',
                            style: { height: '80px' }
                        },
                            [1, 2, 3, 4, 5, 6, 7].map(i => 
                                React.createElement('div', {
                                    key: i,
                                    className: 'w-3 bg-green-500 rounded-full waveform-bar',
                                    style: {
                                        height: `${30 + i * 8}%`
                                    }
                                })
                            )
                        ),
                        React.createElement('div', { className: 'flex justify-center mb-4' },
                            React.createElement('button', {
                                className: 'w-24 h-24 rounded-full flex items-center justify-center shadow-lg relative overflow-hidden',
                                onClick: handleClose,
                                style: {
                                    background: 'radial-gradient(circle, #4ade80 0%, #22c55e 100%)',
                                    width: '96px',
                                    height: '96px'
                                }
                            },
                                React.createElement('svg', {
                                    className: 'w-12 h-12 text-white',
                                    fill: 'none',
                                    stroke: 'currentColor',
                                    viewBox: '0 0 24 24'
                                },
                                    React.createElement('path', {
                                        strokeLinecap: 'round',
                                        strokeLinejoin: 'round',
                                        strokeWidth: 2,
                                        d: 'M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z'
                                    })
                                )
                            )
                        ),
                        // Recognized Command Display
                        state === 'listening' && transcription && React.createElement('div', {
                            className: 'text-center mb-4'
                        },
                            React.createElement('p', {
                                className: 'text-2xl font-bold text-black'
                            }, transcription)
                        ),
                        state === 'error' && React.createElement('div', { className: 'text-center' },
                            React.createElement('p', { className: 'text-red-600 text-sm mb-4' }, errorMessage),
                            React.createElement('button', {
                                onClick: handleRetry,
                                className: 'bg-green-500 text-white rounded-lg py-2 px-6 text-sm font-medium'
                            }, 'Try Again')
                        ),
                        state === 'processing' && React.createElement('div', { className: 'text-center' },
                            React.createElement('div', {
                                className: 'w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full mx-auto mb-4',
                                style: {
                                    animation: 'spin 1s linear infinite'
                                }
                            }),
                            React.createElement('p', { className: 'text-gray-600 text-sm' }, 'Processing...')
                        )
                    )
                )
            );
        };

        // Home Screen
        const MainHomePage = ({ onNavigate }) => {
            return React.createElement('div', { className: 'h-full bg-white overflow-y-auto pb-20' },
                // Top Status Bar
                React.createElement('div', { className: 'pt-2 pb-2 px-4 flex items-center justify-between bg-white border-b border-gray-100' },
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('div', { className: 'w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center' },
                            React.createElement('span', { className: 'text-white text-xs font-semibold' }, 'UPI')
                        )
                    ),
                    React.createElement('div', { className: 'flex items-center gap-3' },
                        React.createElement('div', { className: 'w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center' },
                            React.createElement('span', { className: 'text-yellow-900 text-xs font-bold' }, 'N')
                        ),
                        React.createElement('svg', { className: 'w-6 h-6 text-gray-700', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                            React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9' })
                        ),
                        React.createElement('span', { className: 'text-sm text-gray-900 font-medium' }, '12:55')
                    )
                ),

                // Bills & Recharges Section
                React.createElement('div', { className: 'px-4 pt-6 pb-4 bg-gradient-to-br from-purple-50 to-blue-50 rounded-b-3xl mb-4' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                        React.createElement('h1', { className: 'text-2xl font-bold text-gray-900' }, 'BILLS & RECHARGES'),
                        React.createElement('div', { className: 'flex items-center gap-2 bg-purple-100 px-3 py-1 rounded-full' },
                            React.createElement('svg', { className: 'w-4 h-4 text-purple-600', fill: 'currentColor', viewBox: '0 0 20 20' },
                                React.createElement('path', { d: 'M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z' })
                            ),
                            React.createElement('span', { className: 'text-xs font-semibold text-purple-700' }, 'Win up to ₹1,000')
                        )
                    ),
                    React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                        React.createElement('div', { className: 'flex-1' },
                            React.createElement('p', { className: 'text-green-600 font-bold text-lg mb-1' }, 'ZERO platform fee'),
                            React.createElement('p', { className: 'text-gray-700 text-sm mb-3' }, 'on all bill payments & recharges'),
                            React.createElement('button', {
                                className: 'bg-white text-gray-900 px-6 py-2 rounded-lg font-semibold text-sm shadow-sm',
                                onClick: () => {}
                            }, 'Pay now >>')
                        ),
                        React.createElement('div', { className: 'w-24 h-24 bg-gray-200 rounded-lg flex items-center justify-center' },
                            React.createElement('svg', { className: 'w-16 h-16 text-green-500', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z' })
                            )
                        )
                    )
                ),

                // Quick Actions Section
                React.createElement('div', { className: 'px-4 mb-6' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                        React.createElement('div', { className: 'flex items-center gap-2 bg-purple-100 px-3 py-1.5 rounded-full' },
                            React.createElement('svg', { className: 'w-4 h-4 text-purple-600', fill: 'currentColor', viewBox: '0 0 20 20' },
                                React.createElement('path', { d: 'M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z' })
                            ),
                            React.createElement('span', { className: 'text-xs font-semibold text-purple-700' }, 'Get up to ₹1,000 on every payment')
                        ),
                        React.createElement('div', { className: 'flex items-center gap-1 bg-yellow-100 px-2 py-1 rounded' },
                            React.createElement('div', { className: 'w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center' },
                                React.createElement('span', { className: 'text-yellow-900 text-xs font-bold' }, 'N')
                            ),
                            React.createElement('span', { className: 'text-xs font-semibold text-yellow-800' }, '10=₹1')
                        )
                    ),

                    // Quick Action Icons
                    React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-4' },
                        React.createElement('button', {
                            className: 'flex flex-col items-center gap-2',
                            onClick: () => onNavigate('pay-mobile-number')
                        },
                            React.createElement('div', { className: 'w-14 h-14 bg-green-500 rounded-full flex items-center justify-center' },
                                React.createElement('svg', { className: 'w-7 h-7 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Pay mobile number')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'w-14 h-14 bg-green-500 rounded-full flex items-center justify-center' },
                                React.createElement('svg', { className: 'w-7 h-7 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Pay to UPI ID or Bank')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'w-14 h-14 bg-green-500 rounded-full flex items-center justify-center' },
                                React.createElement('svg', { className: 'w-7 h-7 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Self transfer')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'w-14 h-14 bg-green-500 rounded-full flex items-center justify-center' },
                                React.createElement('svg', { className: 'w-7 h-7 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Check balance')
                        )
                    ),

                    // UPI LITE and Scan & Pay
                    React.createElement('div', { className: 'grid grid-cols-2 gap-3 mb-4' },
                        React.createElement('button', { className: 'bg-white border border-gray-200 rounded-xl p-3 text-left' },
                            React.createElement('div', { className: 'flex items-center gap-2 mb-1' },
                                React.createElement('span', { className: 'text-xs font-bold text-gray-900' }, 'UPI LITE')
                            ),
                            React.createElement('p', { className: 'text-xs text-gray-600 mb-0.5' }, 'PIN less payments'),
                            React.createElement('p', { className: 'text-xs font-semibold text-gray-900' }, '₹2,000 >')
                        ),
                        React.createElement('button', { className: 'bg-purple-600 rounded-xl p-3 flex items-center justify-center gap-2' },
                            React.createElement('svg', { className: 'w-5 h-5 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z' })
                            ),
                            React.createElement('span', { className: 'text-white font-semibold text-xs' }, 'Scan & pay')
                        )
                    ),

                    // My QR Code
                    React.createElement('div', { className: 'bg-green-400 rounded-xl p-3 flex items-center justify-between' },
                        React.createElement('span', { className: 'text-white font-semibold text-xs' }, 'My QR code >'),
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('span', { className: 'text-white text-xs' }, 'UPI ID: johndoe1234@n...'),
                            React.createElement('svg', { className: 'w-4 h-4 text-white', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z' })
                            )
                        )
                    )
                ),

                // Bill Payments Section
                React.createElement('div', { className: 'px-4 mb-6' },
                    React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('h2', { className: 'text-lg font-bold text-gray-900' }, 'Bill payments'),
                            React.createElement('span', { className: 'text-xs font-semibold text-green-600' }, '₹0 PLATFORM FEE')
                        ),
                        React.createElement('button', { className: 'text-sm font-semibold text-purple-600' }, 'My bills')
                    ),
                    React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-4' },
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'relative w-16 h-16 bg-blue-50 rounded-xl flex items-center justify-center' },
                                React.createElement('div', { className: 'absolute -top-1 -right-1 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center' },
                                    React.createElement('span', { className: 'text-xs font-bold text-yellow-900' }, '10%')
                                ),
                                React.createElement('svg', { className: 'w-8 h-8 text-blue-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Mobile recharge')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'relative w-16 h-16 bg-yellow-50 rounded-xl flex items-center justify-center' },
                                React.createElement('div', { className: 'absolute -top-1 -right-1 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center' },
                                    React.createElement('span', { className: 'text-xs font-bold text-yellow-900' }, '5%')
                                ),
                                React.createElement('svg', { className: 'w-8 h-8 text-yellow-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Electricity')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'relative w-16 h-16 bg-purple-50 rounded-xl flex items-center justify-center' },
                                React.createElement('div', { className: 'absolute -top-1 -right-1 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center' },
                                    React.createElement('span', { className: 'text-xs font-bold text-yellow-900' }, '5%')
                                ),
                                React.createElement('svg', { className: 'w-8 h-8 text-purple-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'Credit card')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-2' },
                            React.createElement('div', { className: 'w-16 h-16 bg-gray-100 rounded-xl flex items-center justify-center' },
                                React.createElement('svg', { className: 'w-8 h-8 text-gray-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                    React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 5l7 7-7 7' })
                                )
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-700 font-medium text-center' }, 'More'),
                            React.createElement('span', { className: 'text-xs text-gray-500' }, 'Bharat Connect')
                        )
                    ),
                    React.createElement('button', { className: 'w-full bg-purple-100 rounded-xl p-3 flex items-center justify-between' },
                        React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('svg', { className: 'w-5 h-5 text-purple-600', fill: 'currentColor', viewBox: '0 0 20 20' },
                                React.createElement('path', { d: 'M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z' })
                            ),
                            React.createElement('span', { className: 'text-sm font-semibold text-purple-700' }, '6 offers on bill payments')
                        ),
                        React.createElement('svg', { className: 'w-5 h-5 text-purple-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                            React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M19 9l-7 7-7-7' })
                        )
                    )
                ),

                // Bottom Navigation
                React.createElement('div', { className: 'fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200' },
                    React.createElement('div', { className: 'flex items-center justify-around py-2' },
                        React.createElement('button', { className: 'flex flex-col items-center gap-1' },
                            React.createElement('svg', { className: 'w-6 h-6 text-green-600', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' })
                            ),
                            React.createElement('span', { className: 'text-xs text-green-600 font-semibold' }, 'Home')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-1' },
                            React.createElement('svg', { className: 'w-6 h-6 text-gray-400', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z' })
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-400' }, 'Investment')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-1' },
                            React.createElement('svg', { className: 'w-6 h-6 text-gray-400', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z' })
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-400' }, 'Loans')
                        ),
                        React.createElement('button', { className: 'flex flex-col items-center gap-1' },
                            React.createElement('svg', { className: 'w-6 h-6 text-gray-400', fill: 'none', stroke: 'currentColor', viewBox: '0 0 24 24' },
                                React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 2, d: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z' })
                            ),
                            React.createElement('span', { className: 'text-xs text-gray-400' }, 'Insurance')
                        )
                    )
                )
            );
        };

        const PayMobileNumberScreen = ({ onNavigate, setPaymentData }) => {
            const [searchQuery, setSearchQuery] = useState('');
            const [isVoiceSheetOpen, setIsVoiceSheetOpen] = useState(false);

            const filteredSuggestions = suggestions.filter(item =>
                item.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            const filteredContacts = contacts.filter(contact =>
                contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                contact.phone.includes(searchQuery)
            );

            return (
                <div className="h-full bg-white pb-24 overflow-y-auto relative" style={{position: 'relative', height: '100%'}}>
                    {/* Header */}
                    <header className="pt-4 pb-4 px-4 border-b border-gray-200" style={{paddingTop: 'max(16px, env(safe-area-inset-top) + 16px)'}}>
                        <div className="flex items-center mb-4">
                            <button onClick={() => onNavigate('home')} className="p-2 -ml-2">
                                <svg className="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <h1 className="text-lg font-semibold text-gray-900 flex-1 text-center -ml-8">Pay mobile number</h1>
                        </div>

                        {/* Search Bar */}
                        <div className="relative">
                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2">
                                <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                            <input
                                type="text"
                                placeholder="Search by name or phone number"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="w-full pl-10 pr-4 py-3 bg-gray-100 rounded-lg text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white"
                            />
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="px-4 py-4">
                        {/* Suggestions Section */}
                        {filteredSuggestions.length > 0 && (
                            <div className="mb-6">
                                <h2 className="text-sm font-semibold text-gray-700 mb-3">Suggestions</h2>
                                <div className="space-y-3">
                                    {filteredSuggestions.map((item, index) => {
                                        const { color, initials } = getAvatarStyle(item.name);
                                        return (
                                            <button
                                                key={index}
                                                className="w-full flex items-center py-2 hover:bg-gray-50 rounded-lg transition-colors"
                                            >
                                                <div className={`w-12 h-12 ${color} rounded-full flex items-center justify-center mr-3 flex-shrink-0`}>
                                                    <span className="text-white font-semibold text-sm">{initials}</span>
                                                </div>
                                                <div className="flex-1 text-left">
                                                    <p className="text-gray-900 font-medium">{item.name}</p>
                                                    <p className={`text-sm ${item.type === 'received' ? 'text-green-600' : 'text-gray-600'}`}>
                                                        ₹{item.amount} - {item.status}
                                                    </p>
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Your contacts Section */}
                        {filteredContacts.length > 0 && (
                            <div>
                                <h2 className="text-sm font-semibold text-gray-700 mb-3">Your contacts</h2>
                                <div className="space-y-3">
                                    {filteredContacts.map((contact, index) => {
                                        const { color, initials } = getAvatarStyle(contact.name);
                                        return (
                                            <button
                                                key={index}
                                                className="w-full flex items-center py-2 hover:bg-gray-50 rounded-lg transition-colors"
                                            >
                                                <div className={`w-12 h-12 ${color} rounded-full flex items-center justify-center mr-3 flex-shrink-0`}>
                                                    <span className="text-white font-semibold text-sm">{initials}</span>
                                                </div>
                                                <div className="flex-1 text-left">
                                                    <p className="text-gray-900 font-medium">{contact.name}</p>
                                                    <p className="text-sm text-gray-600">{contact.phone}</p>
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* No Results */}
                        {searchQuery && filteredSuggestions.length === 0 && filteredContacts.length === 0 && (
                            <div className="text-center py-12">
                                <p className="text-gray-500">No contacts found</p>
                            </div>
                        )}
                    </div>

                    {/* Floating Action Button - Voice Payment */}
                    <button
                        onClick={() => setIsVoiceSheetOpen(true)}
                        className="absolute w-16 h-16 bg-green-500 text-white rounded-full shadow-lg hover:shadow-xl transition-shadow flex items-center justify-center z-50"
                        style={{
                            bottom: '24px',
                            right: '24px',
                            position: 'absolute'
                        }}
                        aria-label="Voice Payment"
                    >
                        <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
                        </svg>
                    </button>

                    {/* Voice Bottom Sheet */}
                    {isVoiceSheetOpen && (
                        <VoiceBottomSheet
                            isOpen={isVoiceSheetOpen}
                            onClose={() => setIsVoiceSheetOpen(false)}
                            onPaymentData={(data) => {
                                if (setPaymentData) {
                                    setPaymentData(data);
                                }
                                onNavigate('confirmation');
                            }}
                        />
                    )}
                </div>
            );
        };

        // Voice Listening Screen
        const VoiceListeningScreen = ({ onNavigate, onPaymentData }) => {
            const [transcription, setTranscription] = useState('');
            const [state, setState] = useState('listening');
            const [errorMessage, setErrorMessage] = useState('');
            const voiceRecognitionRef = useRef(null);

            const handleVoiceResult = useCallback((result) => {
                if (result.transcript !== undefined) {
                    setTranscription(result.transcript);
                    return;
                }

                if (result.amount || result.payee) {
                    setState('processing');
                    setTranscription(result.rawText || transcription);
                    setTimeout(() => {
                        onPaymentData({
                            payee: result.payee || 'Unknown',
                            amount: result.amount || '0',
                            method: 'UPI'
                        });
                        onNavigate('confirmation');
                    }, 1500);
                } else {
                    setState('error');
                    setErrorMessage('Could not understand the command. Please say something like "Pay ₹500 to Rahul"');
                }
            }, [transcription, onNavigate, onPaymentData]);

            const handleVoiceError = useCallback((error) => {
                setState('error');
                if (error === 'no-speech') {
                    setErrorMessage('No speech detected. Please try again.');
                } else if (error === 'not-allowed') {
                    setErrorMessage('Microphone permission denied. Please enable microphone access.');
                } else {
                    setErrorMessage('Voice recognition error. Please try again.');
                }
            }, []);

            useEffect(() => {
                if (state === 'listening') {
                    const voiceRecognition = createVoiceRecognition(handleVoiceResult, handleVoiceError);
                    voiceRecognitionRef.current = voiceRecognition;

                    if (voiceRecognition.isSupported) {
                        voiceRecognition.start();
                    } else {
                        setState('error');
                        setErrorMessage('Voice recognition is not supported in your browser. Please use Chrome or Edge.');
                    }

                    return () => {
                        // Don't stop - keep instance alive for reuse
                    };
                }
            }, [state, handleVoiceResult, handleVoiceError]);

            const handleCancel = () => {
                if (voiceRecognitionRef.current) {
                    voiceRecognitionRef.current.stop();
                }
                onNavigate('home');
            };

            const handleRetry = () => {
                // Stop current recognition first
                if (voiceRecognitionRef.current) {
                    voiceRecognitionRef.current.stop();
                }
                // Reset all state
                setTranscription('');
                setErrorMessage('');
                // Small delay before restarting to ensure clean state
                setTimeout(() => {
                    setState('listening');
                }, 100);
            };

            return (
                <div className="h-full bg-gradient-to-b from-blue-50 to-white p-6 overflow-y-auto">
                    <header className="pt-12 pb-6">
                        <button onClick={handleCancel} className="mb-4 p-2 -ml-2">
                            <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                        <h1 className="text-2xl font-bold text-gray-900">Listening...</h1>
                    </header>
                    <div className="flex-1 flex flex-col items-center justify-center pb-12">
                        {state === 'listening' && (
                            <>
                                <div className="flex items-end justify-center gap-1 mb-8 h-24">
                                    {[1,2,3,4,5,6,7].map(i => (
                                        <div key={i} className="w-3 bg-blue-600 rounded-full waveform-bar" style={{height: `${30 + i * 8}%`}} />
                                    ))}
                                </div>
                                <div className="w-full max-w-sm mb-6">
                                    <div className="bg-white rounded-xl p-6 shadow-lg min-h-[120px] flex items-center justify-center">
                                        <p className="text-2xl text-gray-800 font-medium text-center">
                                            {transcription || <span className="text-gray-400">Listening...</span>}
                                        </p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 text-blue-600 mb-8">
                                    <div className="w-3 h-3 bg-blue-600 rounded-full pulse-animate" />
                                    <span className="text-sm font-medium">Listening</span>
                                </div>
                                <div className="w-full max-w-sm text-center">
                                    <p className="text-sm text-gray-500 mb-2">
                                        Say something like: <span className="font-semibold text-blue-600">"Pay ₹500 to Rahul"</span>
                                    </p>
                                    <p className="text-xs text-gray-400">
                                        The payment will process automatically 3.5 seconds after you stop speaking
                                    </p>
                                </div>
                            </>
                        )}
                        {state === 'processing' && (
                            <div className="flex flex-col items-center">
                                <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full mb-6 spin" />
                                <p className="text-lg text-gray-700 font-medium">Processing your request...</p>
                            </div>
                        )}
                        {state === 'error' && (
                            <div className="flex flex-col items-center">
                                <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6">
                                    <svg className="w-10 h-10 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </div>
                                <p className="text-lg text-gray-800 font-semibold mb-2">Couldn't understand</p>
                                <p className="text-gray-600 text-center mb-6">{errorMessage}</p>
                                <button onClick={handleRetry} className="bg-blue-600 text-white rounded-xl py-3 px-6 font-medium">
                                    Try Again
                                </button>
                            </div>
                        )}
                    </div>

                </div>
            );
        };

        // Payment Confirmation Screen
        const PaymentConfirmationScreen = ({ onNavigate, paymentData }) => {
            const [amount, setAmount] = useState(paymentData?.amount || '400');
            const payee = paymentData?.payee || 'Prashant Upadhyay';
            const upiId = `${payee.toLowerCase().replace(/\s+/g, '')}@okicici`;


            const handleConfirm = () => {
                onNavigate('success');
            };

            return (
                <div className="h-full bg-white overflow-hidden flex flex-col relative">
                    {/* Header */}
                    <header className="pt-4 pb-4 px-4 border-b border-gray-200">
                        <div className="flex items-center justify-between mb-3">
                            <button onClick={() => onNavigate('home')} className="p-2 -ml-2">
                                <svg className="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <h1 className="text-lg font-semibold text-gray-900">Paying to</h1>
                            <button className="p-2 -mr-2">
                                <svg className="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                                </svg>
                            </button>
                        </div>
                        
                        {/* Recipient Info */}
                        <div className="flex items-center justify-between">
                            <div className="flex items-center">
                                <h2 className="text-2xl font-bold text-gray-900 mr-2">{payee}</h2>
                                <svg className="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <div className="mt-1">
                            <p className="text-sm text-gray-600">{upiId}</p>
                        </div>
                    </header>

                    {/* Main Content */}
                    <div className="flex-1 overflow-y-auto px-4 py-6 pb-24">
                        {/* Amount Display */}
                        <div className="text-center mb-6">
                            <p className="text-6xl font-bold text-gray-900">₹{amount}</p>
                        </div>

                        {/* Add Notes Button */}
                        <button className="w-full bg-gray-100 text-gray-700 rounded-lg py-3 px-4 mb-6 text-left">
                            Add notes
                        </button>

                        {/* Payment Method Card */}
                        <div className="bg-white border border-gray-200 rounded-xl p-4 mb-6 shadow-sm">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center flex-1 min-w-0">
                                    <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                        <span className="text-white text-xl font-bold">∞</span>
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <p className="text-base font-medium text-gray-900 truncate">Kotak Mahindra Bank - 1234</p>
                                        <p className="text-sm text-gray-600">
                                            Balance : <button className="text-blue-600 underline">Check now</button>
                                        </p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 flex-shrink-0">
                                    <span className="text-xs text-gray-500 whitespace-nowrap">Powered by UPI</span>
                                    <svg className="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Pay Button - Fixed at bottom */}
                    <div className="absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200">
                        <button
                            onClick={handleConfirm}
                            className="w-full bg-green-600 text-white rounded-xl py-4 px-6 text-lg font-semibold shadow-lg hover:bg-green-700"
                        >
                            Pay ₹{amount}
                        </button>
                    </div>
                </div>
            );
        };

        // Success Screen
        const SuccessScreen = ({ onNavigate, paymentData }) => {
            const [isDetailsOpen, setIsDetailsOpen] = useState(false);
            const payee = paymentData?.payee || 'Unknown';
            const amount = paymentData?.amount || '0';
            const method = paymentData?.method || 'UPI';
            const transactionId = 'TXN' + Date.now().toString().slice(-8);
            const time = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });

            return (
                <div className="h-full bg-gradient-to-b from-green-50 to-white p-6 overflow-y-auto">
                    <div className="flex-1 flex flex-col items-center justify-center pt-12 pb-12">
                        <div className="w-32 h-32 bg-green-500 rounded-full flex items-center justify-center mb-8 shadow-lg">
                            <svg className="w-16 h-16 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <h1 className="text-3xl font-bold text-gray-900 mb-3 text-center">Payment Successful!</h1>
                        <p className="text-lg text-gray-600 mb-8 text-center">₹{amount} sent to {payee} successfully</p>
                        
                        {/* Transaction Details - Collapsible */}
                        <div className="w-full max-w-sm bg-white rounded-2xl shadow-lg mb-6 overflow-hidden">
                            <button
                                onClick={() => setIsDetailsOpen(!isDetailsOpen)}
                                className="w-full p-6 flex items-center justify-between hover:bg-gray-50 transition-colors"
                            >
                                <h2 className="text-lg font-semibold text-gray-900">Transaction Details</h2>
                                <svg
                                    className="w-5 h-5 text-gray-600 transition-transform"
                                    style={{ transform: isDetailsOpen ? 'rotate(180deg)' : 'rotate(0deg)' }}
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            
                            {isDetailsOpen && (
                                <div className="px-6 pb-6 space-y-4" style={{ animation: 'fadeIn 0.3s ease-in-out' }}>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Transaction ID</span>
                                        <span className="text-sm font-mono text-gray-900">{transactionId}</span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Amount</span>
                                        <span className="text-sm font-semibold text-gray-900">₹{amount}</span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Recipient</span>
                                        <span className="text-sm font-medium text-gray-900">{payee}</span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Method</span>
                                        <span className="text-sm font-medium text-gray-900">{method}</span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Time</span>
                                        <span className="text-sm font-medium text-gray-900">{time}</span>
                                    </div>
                                    <div className="text-center">
                                        <span className="text-sm text-gray-600 block mb-1">Status</span>
                                        <span className="text-sm font-semibold text-green-600">Completed</span>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* Action Buttons */}
                        <div className="w-full max-w-sm space-y-3">
                            <button onClick={() => onNavigate('home')} className="w-full bg-green-600 text-white rounded-xl py-4 px-6 text-lg font-semibold shadow-lg hover:bg-green-700">
                                Done
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [currentScreen, setCurrentScreen] = useState('home');
            const [paymentData, setPaymentData] = useState(null);

            const handleNavigate = (screen) => {
                setCurrentScreen(screen);
            };

            const handlePaymentData = (data) => {
                setPaymentData(data);
            };

            return (
                <div className="mobile-container">
                    {currentScreen === 'home' && (
                        <MainHomePage 
                            onNavigate={handleNavigate}
                        />
                    )}
                    {currentScreen === 'pay-mobile-number' && (
                        <PayMobileNumberScreen 
                            onNavigate={handleNavigate} 
                            setPaymentData={setPaymentData}
                        />
                    )}
                    {currentScreen === 'listening' && <VoiceListeningScreen onNavigate={handleNavigate} onPaymentData={handlePaymentData} />}
                    {currentScreen === 'confirmation' && <PaymentConfirmationScreen onNavigate={handleNavigate} paymentData={paymentData} />}
                    {currentScreen === 'success' && <SuccessScreen onNavigate={handleNavigate} paymentData={paymentData} />}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

